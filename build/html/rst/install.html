<!DOCTYPE html>
<html class="writer-html5" lang="en-English" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Steps of VQNet Installation &mdash; VQNET v0.13 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quantum Machine Learning Demos" href="qml_demo.html" />
    <link rel="prev" title="VQNet" href="../index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> VQNET
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Steps of VQNet Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#vqnet-python-package-installation">VQNet python package Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vqnet-s-installation-successfully">VQNet’s installation successfully.</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-simple-case-of-vqnet">A simple case of VQNet</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Hand by hand tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="qml_demo.html">Quantum Machine Learning Demos</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="QTensor.html">QTensor Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="nn.html">Classical Neural Network Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="qnn.html">Quantum Machine Learning Module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VQNET</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Steps of VQNet Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/rst/install.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="steps-of-vqnet-installation">
<h1>Steps of VQNet Installation<a class="headerlink" href="#steps-of-vqnet-installation" title="Permalink to this headline">¶</a></h1>
<section id="vqnet-python-package-installation">
<h2>VQNet python package Installation<a class="headerlink" href="#vqnet-python-package-installation" title="Permalink to this headline">¶</a></h2>
<p>We provide different pre-compiled packages based on python with Linux, Windows, MacOS, which Python version &gt;= 3.6, numpy&gt;=1.18.5 and pyqpanda&gt;=3.7.8 will required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvqnet</span>
</pre></div>
</div>
</section>
<section id="vqnet-s-installation-successfully">
<h2>VQNet’s installation successfully.<a class="headerlink" href="#vqnet-s-installation-successfully" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyvqnet</span>
<span class="kn">from</span> <span class="nn">pyvqnet.tensor</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="a-simple-case-of-vqnet">
<h2>A simple case of VQNet<a class="headerlink" href="#a-simple-case-of-vqnet" title="Permalink to this headline">¶</a></h2>
<p>Here we introduced a case which consisted with classical neural network modules and quantum modules of VQNet to describing the workflow of quantum machine learning. It refers to <cite>Data re-uploading for a universal quantum classifier &lt;https://arxiv.org/abs/1907.02085&gt;</cite>.
Generally, there are following parts of quantum computing module in quantum machine learning:</p>
<p>(1)Encoder:encoding classical data into quantum state;
(2)Ansats: traning the parameters in Parameterized Quantum Gates;
(3)Measurement: measuring the value of a qubit(projection of qubit’s quantum state in a specified axis).</p>
<p>For the computation of quantum computing module is differentiable, so quantum computing module and classical computing module(convolution layer, pooling layer, fully connected layer, activation layer, and multiple optimized algorithm model) be supported by VQNet.
.. figure:: ./images/classic-quantum.PNG</p>
<p>Using the interface of quantum logic gate, quantum simulator, Measurement of ‘pyqpanda&lt;<a class="reference external" href="https://pyqpanda-toturial.readthedocs.io/zh/latest/">https://pyqpanda-toturial.readthedocs.io/zh/latest/</a>&gt;’ provided by Origin Quantum.
Building a quantum computing module by the pyqpanda, it can be trained as a part of VQNet.
Based on a qubit, using multiple Parameterized rotated gate like ‘RX’, ‘RY’, ‘RZ’ to encoding ‘x’ into a quantum state as a input, meanwhile using ‘prob_run_dict()’ to detecting the probilities of Measurement as a output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">qdrl_circuit</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span><span class="n">weights</span><span class="p">,</span><span class="n">qlist</span><span class="p">,</span><span class="n">clist</span><span class="p">,</span><span class="n">machine</span><span class="p">):</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">param1</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">circult</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QCircuit</span><span class="p">()</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RY</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
        <span class="n">circult</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pq</span><span class="o">.</span><span class="n">RZ</span><span class="p">(</span><span class="n">qlist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param1</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>

        <span class="n">prog</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">QProg</span><span class="p">()</span>

        <span class="n">prog</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">circult</span><span class="p">)</span>

        <span class="n">prob</span> <span class="o">=</span> <span class="n">machine</span><span class="o">.</span><span class="n">prob_run_dict</span><span class="p">(</span><span class="n">prog</span><span class="p">,</span> <span class="n">qlist</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">prob</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">prob</span>
</pre></div>
</div>
<p>Our task is classify these data which is generated randomly based on binary classification algorithm. In the model, 0 is a circle’s center, points within radius by 1 (2 dimension)colored in red are one category, and blue is anothe</p>
<figure class="align-default">
<img alt="../_images/origin_circle.png" src="../_images/origin_circle.png" />
</figure>
<p>Traning the workflow of testing code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import required libraries and functions</span>
<span class="kn">from</span> <span class="nn">pyvqnet.qnn.qdrl.vqnet_model</span> <span class="kn">import</span> <span class="n">qdrl_circuit</span>
<span class="kn">from</span> <span class="nn">pyvqnet.qnn.quantumlayer</span> <span class="kn">import</span> <span class="n">QuantumLayer</span>
<span class="kn">from</span> <span class="nn">pyvqnet.optim</span> <span class="kn">import</span> <span class="n">adam</span>
<span class="kn">from</span> <span class="nn">pyvqnet.nn.loss</span> <span class="kn">import</span> <span class="n">CategoricalCrossEntropy</span>
<span class="kn">from</span> <span class="nn">pyvqnet.tensor.tensor</span> <span class="kn">import</span> <span class="n">QTensor</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyvqnet.nn.module</span> <span class="kn">import</span> <span class="n">Module</span>
</pre></div>
</div>
<p>Defining a model, where ‘__init__’ function defines the internal neural network modules and quantum modules, and ‘forward’ function defines the forward function,’QuantumLayer’ is an abstract class that encapsulates quantum computing.
There will calculating the parameters’ gradient automatically with’qdrl_circuit’, ‘param_num’, ‘cpu’, ‘qbit_num’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># uumber of parameters to be trained</span>
<span class="n">param_num</span> <span class="o">=</span> <span class="n">n_eval</span>
<span class="c1"># qubit number</span>
<span class="n">qbit_num</span>  <span class="o">=</span> <span class="mi">1</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pqc</span> <span class="o">=</span> <span class="n">QuantumLayer</span><span class="p">(</span><span class="n">qdrl_circuit</span><span class="p">,</span><span class="n">param_num</span><span class="p">,</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span><span class="n">qbit_num</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pqc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
<p>Definite some functions of training model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># a function to generating the raw data randomly</span>
<span class="k">def</span> <span class="nf">circle</span><span class="p">(</span><span class="n">samples</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>  <span class="n">rads</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="p">:</span>
    <span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">samples</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">rads</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">data_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">data_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>

<span class="c1"># a funntion to loading data</span>
<span class="k">def</span> <span class="nf">get_minibatch_data</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">batch_size</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">x_data</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">label</span><span class="p">[</span><span class="n">idxs</span><span class="p">]</span>

<span class="c1"># a function to computing the accuracy</span>
<span class="k">def</span> <span class="nf">get_score</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">pred</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred</span><span class="o">.</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">pred</span> <span class="o">==</span> <span class="n">score</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span>
</pre></div>
</div>
<p>VQNet following the general workflow of machine learning: loading the data iteratively, front propagation, calculate loss function, back propagation, update the parameter, etc.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># instantiating a model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="c1"># using Adam to define a optimizer</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">adam</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span><span class="n">lr</span> <span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="c1"># using cross-entropy to define a loss function</span>
<span class="n">Closs</span> <span class="o">=</span> <span class="n">CategoricalCrossEntropy</span><span class="p">()</span>
</pre></div>
</div>
<p>A function to training the model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train</span><span class="p">():</span>

    <span class="c1">#  generate data to be trained randomly</span>
    <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">x_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">x_train</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="c1"># define the number of data about each batch</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="c1"># Maximum of training iteration times</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start training...........&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epoch</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">get_minibatch_data</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="c1"># clear the cache of optimizer</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="c1"># forward computing</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># calculating loss function</span>
            <span class="n">losss</span> <span class="o">=</span> <span class="n">Closs</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
            <span class="c1"># anti-propagation</span>
            <span class="n">losss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="c1"># update the parameter of optimizer</span>
            <span class="n">optimizer</span><span class="o">.</span><span class="n">_step</span><span class="p">()</span>
            <span class="c1"># calculate the accuracy</span>
            <span class="n">accuracy</span> <span class="o">+=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>

            <span class="n">loss</span> <span class="o">+=</span> <span class="n">losss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="n">batch_size</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epoch:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, train_accuracy:</span><span class="si">{</span><span class="n">accuracy</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;epoch:</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, train_loss:</span><span class="si">{</span><span class="n">loss</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>A function to validating the model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>

    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start eval...................&quot;</span><span class="p">)</span>
    <span class="n">xtest</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">circle</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">test_accuracy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">xtest</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="n">predicted_test</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">test_data</span><span class="p">,</span> <span class="n">test_label</span> <span class="ow">in</span> <span class="n">get_minibatch_data</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>

        <span class="n">test_data</span><span class="p">,</span> <span class="n">test_label</span> <span class="o">=</span> <span class="n">QTensor</span><span class="p">(</span><span class="n">test_data</span><span class="p">),</span><span class="n">QTensor</span><span class="p">(</span><span class="n">test_label</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
        <span class="n">test_accuracy</span> <span class="o">+=</span> <span class="n">get_score</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">test_label</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="n">batch_size</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test_accuracy:</span><span class="si">{</span><span class="n">test_accuracy</span><span class="o">/</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Training the test result</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="n">training</span><span class="o">...........</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.6145833333333334</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.020432369535168013</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.6854166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01872217481335004</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8104166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016634768371780715</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.7479166666666667</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016975031544764835</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.7875</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016502128106852372</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.0163204787299037</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01634311651190122</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016330583145221074</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8125</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.01629052646458149</span>

<span class="n">epoch</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="n">train_accuracy</span><span class="p">:</span><span class="mf">0.8083333333333333</span>
<span class="n">epoch</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">:</span><span class="mf">0.016270687493185203</span>

<span class="n">start</span> <span class="nb">eval</span><span class="o">...................</span>
<span class="n">test_accuracy</span><span class="p">:</span><span class="mf">0.826</span>
</pre></div>
</div>
<figure class="align-default">
<img alt="../_images/qdrl_for_simple.png" src="../_images/qdrl_for_simple.png" />
</figure>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../index.html" class="btn btn-neutral float-left" title="VQNet" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="qml_demo.html" class="btn btn-neutral float-right" title="Quantum Machine Learning Demos" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Original Quantum.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>